{{define "apps"}}
    {{range $appId, $app := .}}
        <div id="panel-apps-{{$appId}}"
            hx-get="/project/app/{{$appId}}"
            hx-trigger="load"
            hx-swap="outerHTML"
            hx-target="#panel-apps-{{$appId}}"></div>
    {{end}}

    <button hx-get="/project/app/create" 
        hx-trigger="click"
        hx-swap="innerHTML"
        hx-target="#panel-apps-content">+</button>
{{end}}

{{define "app"}}
    <div id="panel-apps-{{.Id}}" style="border: 1px dashed #F1F1F8;">
        <form>
            <label for="project-{{.Id}}-image">container image {{ .Errors.image }}</label>
                
            <input type="text" 
                name="project-{{.Id}}-image" 
                value="{{ .App.Image }}" 
                hx-post="/project/app/{{.Id}}/image"
                hx-trigger="change delay:500ms" 
                hx-swap="outerHTML"
                hx-target="#panel-apps-{{.Id}}" />

        <table id="project-{{.Id}}-env">
            <tr>
                <th>environment variable</th>
                <th>value</th>
            </tr>

            {{range $envId, $env := .App.Env}}
            <tr>
                <td>
                    <input type="text" 
                        name="project-{{$.Id}}-env-{{$envId}}-key" 
                        value="{{$env.Key}}"
                        hx-post="/project/app/{{$.Id}}/env/{{$envId}}"
                        hx-trigger="change delay:500ms" 
                        hx-swap="none" />
                </td>

                <td>
                    <input type="text"
                        name="project-{{$.Id}}-env-{{$envId}}-val"
                        value="{{$env.Value}}"
                        hx-post="/project/app/{{$.Id}}/env/{{$envId}}"
                        hx-trigger="change delay:500ms"
                        hx-swap="none" />
                </td>

                <td>
                    <button hx-delete="/project/app/{{$.Id}}/env/{{$envId}}"
                        hx-trigger="click"
                        hx-swap="outerHTML"
                        hx-target="#panel-apps-{{$.Id}}">delete</button>
                </td>
            </tr>
            {{end}}

            <tr>
                <td>
                    <input type="text" name="project-{{.Id}}-env-key" />
                </td>

                <td>
                    <input type="text" name="project-{{.Id}}-env-val" />
                </td>

                <td>
                    <button hx-post="/project/app/{{.Id}}/env" 
                        hx-trigger="click"
                        hx-swap="outerHTML"
                        hx-target="#panel-apps-{{.Id}}">+</button>
                </td>
            </tr>
        </table>

        <button hx-delete="/project/app/{{.Id}}" 
            hx-trigger="click" 
            hx-swap="innerHTML"
            hx-target="#panel-apps-content">delete</button>
    </form>
</div>
{{end}}